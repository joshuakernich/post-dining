<!DOCTYPE html>
<html>
<head>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta charset="UTF-8">
  <title>Restraint</title>
   <script type="text/javascript" src='./js/jq.js'></script>
   <script type="text/javascript" src='./js/screen-pin.js'></script>
   <script type="text/javascript" src='./js/screen-shop.js'></script>
   <script type="text/javascript" src='./js/screen-herald.js'></script>
   <script type="text/javascript" src='./js/screen-alloc.js'></script>
   <script type="text/javascript" src='./js/screen-lecture.js'></script>
   <script type="text/javascript">
    
    // changeable data
    var DATA = {};

   </script>
   <script type="text/javascript" src='./data/data-burger-bar.js'></script>
   <script type="text/javascript" src='./data/data-show.js'></script>
   <link rel="stylesheet" href="./index.css">
   <link rel="stylesheet" href="./shop.css">
  
  <script type="text/javascript">


    $(function(){
      DATA.sequence = DATA.SHOW; // show by default

      if(window.location.href.indexOf('burger')>-1){
        DATA.sequence = DATA.BURGER;
        DATA.isMuted = true;
      }
      start();
    })

    function start(){

      var types = {
        'screen-herald':ScreenHerald,
        'screen-lecture':ScreenLecture,
        'screen-alloc':ScreenAlloc,
        'screen-shop':ScreenShop,
        'screen-pin':ScreenPin,
      }

      var utils = {
        utter:utter,
        toNextScreen:toNextScreen,
        doAnimatedType:doAnimatedType,
        doAnimatedStat:doAnimatedStat,
        alloc:400, // default for the burger bar
      }

      var idxWas = -1;
      var screens = [];
      var synth = window.speechSynthesis;
      var utters = [];

      //load up the data
      for(var s in DATA.sequence){
        var def = DATA.sequence[s];
        var $s = $('.screen-templates .'+def.type).clone().appendTo('.device');

        var fn = types[def.type];
        screens[s] = new fn($s,def,utils);

        $s.find('.action-to-next-screen').click(onNextScreen);
      }

      function onNextScreen(e){
        toNextScreen(e.target);
      }

      function toNextScreen(child){
        var idx = $('.device .screen').index($(child).closest('.screen'));
        if(idx+1 >= $('.device .screen').length){
          window.location = window.location; // HARD RESET
        } else {
          toScreen(idx+1);
        }
      }

      function toScreen(idx){
        if(screens[idxWas] && screens[idxWas].deactivate) screens[idxWas].deactivate();

        while(utters.length) clearInterval(utters.pop());
        synth.cancel();

        $('.device .screen').hide().eq(idx).show();
        if(screens[idx].activate) screens[idx].activate();

        idxWas = idx;
      }

      function utter(text,delay){
        if(DATA.isMuted) return;
        utters.push( setTimeout(function(){
            var utter = new SpeechSynthesisUtterance(text);
            utter.voice = synth.getVoices()[0];
            synth.speak(utter);
          },delay));
      }

      function doAnimatedType( $d, delay, bUtter ){
        var text = $d.text();
        var chars = '<span>'+text.split('').join('</span><span>') + '</span>';
        $d.html(chars);

        $d.find('span').each(function(i){

          $(this).css({opacity:0,background:'orange'}).delay(delay+i*50).animate({opacity:1},40,function(){
            $(this).css({background:'transparent'});
          });
        });

        if(bUtter){
          utter(text,delay);
        }

        return text.length*50;
      }

      function doAnimatedStat( $d, delay ){
        var text = $d.text();
        var int = parseInt(text);
        $d.css({opacity:0}).delay(delay).animate({opacity:1},10);

        $d.text('0');
        
        $({int:0}).delay(delay).animate({int:int},{duration:text.length*100,step:function(val){
          
          $d.text(Number(Math.floor(val)).toLocaleString());
          $('.sound-blip')[0].play();
        }})

        return text.length*100;
      }

      toScreen(0);
    }

  </script>
  <div class="screen-templates">
    <div class="screen screen-pin">
      <div class="layer" style="opacity:0.2;background-image: url(./globe-orange.gif)"></div>
      <div class="layer" style="text-align: center;">
        <!--div class="box">
          <img width="90"style="vertical-align:middle;display: inline-block;" src='./water-dollar-symbol.png'>
          <div style="vertical-align:middle;display:inline-block;text-align:center;">
            <p style="font-size:180px;line-height:100px;margin:0px;">GWAT</p>
            <p style="margin:10px;font-size: 22px;">Global Water Allocation Trust</p>
          </div>
          <br>
        </div><br-->
        <div class="box" style="margin-top:20px;">
        <h2>Enter Employee ID CODE</h2>
          <div class="pins">
            <div class="pin focus"></div>
            <div class="pin"></div>
            <div class="pin"></div>
            <div class="pin"></div>
            <div class="pin"></div>
            <div class="pin"></div>
            <div class="pin"></div>
          </div>
          <br>
          <p class="pin-feedback" style="margin:0px;"></p>
        </div>
        <div class="keypad"></div>
      </div>
    </div>
    <div class="screen screen-herald">
      <div class="layer" style="opacity:0.2;background-image: url(./globe-orange.gif)"></div>
      <div class="layer" style="text-align: center;">
        <br><br>
        <div class="box">
          <h1>Hello</h1>
          <button class="action-to-next-screen">BEGIN</button>
        </div>
      </div>
    </div>
    <div class="screen screen-lecture">
       <div class="layer" style="opacity:0.6;background-image: url(./ripples.gif)"></div>
       <div class="layer">
        <div class="box" style="text-align: left;padding:0px 20px 20px;margin-top: 20px;">
          <div class="intro-monologue">
            <!-- lecture goes here -->
          </div>
        <button class="action-to-next-screen">CONTINUE</button></div>
      </div>
    </div>
    <div class="screen screen-alloc">
       <div class="layer" style="opacity:0.6;background-image: url(./ripples.gif)"></div>
       <div class="layer">
        <div class="box" style="margin-top:20px;">

          <p class="stockpile"><span class='wd-stat pos'>WORLD WATER stockpile</span><span class='wd'>89582618271</span></p>
          <h2 style="font-size: 35px;">Calculating personal water allocation.</h2>

          <ul class="wd-chart">
            <li><span class='wd-stat pos'>Universal daily allocation</span><span class='wd'>212</span></li>
            <li><span class='wd-stat'>Shower: 6 minutes</span><span class='wd neg'>37</span></li>
            <li><span class='wd-stat'>Faucet: 12 seconds</span><span class='wd neg'>6</span></li>
            <li><span class='wd-stat'>Faucet: 15 seconds</span><span class='wd neg'>8</span></li>
            <li><span class='wd-stat pos'>TOTAL ALLOCATION</span><span class='wd total'>152</span></li>
          </ul>
          <br>
          <button class="action-to-next-screen">REDEEM ALLOCATION</button>
        </div>
      </div>
    </div>
    <div class="screen screen-shop">
      <!-- other shop pages will be inserted here -->
      <div class="shop-page shop-page-checkout">
        <div class="summary">
        <!-- ingredient images here -->
        </div>
        <div class="box summary-box">
          <!-- ingredient list here -->
          <hr>
          <h2><span class='name'>TOTAL</span> <span class="wd wd-total">32</span></h2>

          <p class='alloc-error'>You have exceeded your water allocation. Please select an ingredient to change.</p>
          <button class="redeem">REDEEM</button>
        </div>
        
      </div>
      <div class="top-right-tab">
        <div class="wd-alloc">
          <span class='wd-spent'>0</span> of <span class="wd-of">152</span>
        </div>
        <div class='timer'>2:00</div>
      </div>
      <ul class="breadcrumbs"><li>Checkout</li></ul>
      <!--div class="screen screen-outro">
        <div class="layer" style="opacity:0.2;background-image: url(./globe-orange.gif)"></div>
        <div class="layer" style="text-align: center;">
          <br>
          <br>
          <br>
          <div class="box">
            <h1>Thankyou for making choices that support a fair water distribution for all.</h1>
            <br><br>
            <button class="action-to-start">FINISH</button>
          </div>
        </div>
      </div-->
    </div>
  </div>
</head>
<body>
  
  <div class="device">
    
    
    

    
    
    <!--div class="screen screen-selector screen-breadcrumbed">

        <h1>Select a <b>Carbohydrate</b></h1>

          <div class="ingredient">
            <div class="ingredient-img" style="background-image:url(./img/wafer.png)"></div>
            <h2><span class='name'>Wafer</span> <span class="wd">12</span></h2>
            <p>A delicate cracker with a crunchy texture.</p>
            <button>Confirm</button>
          </div>
          <div class="ingredient">
            <div class="ingredient-img" style="background-image:url(./img/crispbread.png)"></div>
            <h2><span class='name'>Crispbread</span> <span class="wd">32</span></h2>
            <p>Sun-ripened maize, popped and pressed.</p>
            <button>Confirm</button>
          </div>
          <div class="ingredient">
            <div class="ingredient-img" style="background-image:url(./img/bread.png)"></div>
            <h2><span class='name'>Bread</span> <span class="wd">96</span></h2>
            <p>Wheat dough, ground, rested, and baked.</p>
            <button>Confirm</button>
          </div>

    </div>
    <div class="screen screen-selector screen-breadcrumbed">

        <h1>Select a <b>Protein</b></h1>

          <div class="ingredient">
            <div class="ingredient-img" style="background-image:url(./img/cheese.png)"></div>
            <h2><span class='name'>Cheese</span> <span class="wd">12</span></h2>
            <p>Cow nipple juice and some bacteria.</p>
            <button>Confirm</button>
          </div>
          <div class="ingredient">
            <div class="ingredient-img" style="background-image:url(./img/salmon.png)"></div>
            <h2><span class='name'>Salmon</span> <span class="wd">32</span></h2>
            <p>Farm-grown, caught, and smoked.</p>
            <button>Confirm</button>
          </div>
          <div class="ingredient">
            <div class="ingredient-img" style="background-image:url(./img/lamb.png)"></div>
            <h2><span class='name'>Lamb</span> <span class="wd">96</span></h2>
            <p>Farm raised, slaughtered, and aged.</p>
            <button>Confirm</button>
          </div>
        
    </div>
    <div class="screen screen-selector screen-breadcrumbed">
        
        <h1>Select a <b>Topping</b></h1>

          <div class="ingredient">
            <div class="ingredient-img" style="background-image:url(./img/parsley.png)"></div>
            <h2><span class='name'>Parsley</span> <span class="wd">12</span></h2>
            <p>A little bitter, leafy thingo.</p>
            <button>Confirm</button>
          </div>
          <div class="ingredient">
            <div class="ingredient-img" style="background-image:url(./img/salsa.png)"></div>
            <h2><span class='name'>Salsa</span> <span class="wd">32</span></h2>
            <p>A blob of chunky, red sunshine.</p>
            <button>Confirm</button>
          </div>
          <div class="ingredient">
            <div class="ingredient-img" style="background-image:url(./img/aoili.png)"></div>
            <h2><span class='name'>Aoili</span> <span class="wd">96</span></h2>
            <p>Creamy, eggy white gloop.</p>
            <button>Confirm</button>
          </div>
        
    </div-->
    <!--div class="screen screen-checkout screen-breadcrumbed">
      
    </div-->
     <!--div class="screen screen-outro">
      <div class="layer" style="opacity:0.2;background-image: url(./globe-orange.gif)"></div>
 
      <div class="layer" style="text-align: center;">
        <br>
        <div class="box">
         
          <img width="90"style="vertical-align:middle;display: inline-block;" src='./water-dollar-symbol.png'>
          <div style="vertical-align:middle;display:inline-block;text-align:center;">
            <p style="font-size:180px;line-height:100px;margin:0px;">GWAT</p>
            <p style="margin:10px;font-size: 22px;">Global Water Allocation Trust</p>
          </div>
          <br>
        </div>
        <div class="box">
          Personal CANAPE CODE
          <h1 style="color:var(--col-b);font-size: 150px;">A2B</h1>
          <button class="action-to-start">FINISH</button>
        </div>
        
      </div>
    </div-->
    
    
  </div>
  <audio class="sound-blip">
    <source src="./blip.wav" type="">
  </audio>
  <audio class="sound-select">
    <source src="./select.wav" type="">
  </audio>
  <audio class="sound-error">
    <source src="./error.wav" type="">
  </audio>
</body>
</html>